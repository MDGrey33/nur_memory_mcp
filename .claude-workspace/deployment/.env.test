# MCP Memory - Test Environment Configuration
# ============================================
# Port offset: +200 from production
# Usage: docker compose -f docker-compose.test.yml --env-file .env.test up -d

# ============================================================================
# ENVIRONMENT IDENTIFICATION
# ============================================================================
ENVIRONMENT=test
ENV_SUFFIX=_test
COMPOSE_PROJECT_NAME=mcp-memory-test
CONTAINER_PREFIX=mcp-test

# ============================================================================
# PORT CONFIGURATION (Production +200)
# ============================================================================
# MCP Server: 3001 (prod) -> 3201 (test)
MCP_PORT=3201
MCP_HTTPS_PORT=3643

# ChromaDB: 8001 (prod) -> 8201 (test)
CHROMA_PORT_EXTERNAL=8201

# PostgreSQL: 5432 (prod) -> 5632 (test)
POSTGRES_PORT_EXTERNAL=5632

# pgAdmin: 5050 (prod) -> 5250 (test)
PGADMIN_PORT=5250

# MCP Inspector: 6274 (prod) -> 6474 (test)
MCP_INSPECTOR_PORT=6474

# Debug ports
DEBUG_PORT_SERVER=5878
DEBUG_PORT_WORKER=5879

# ============================================================================
# NETWORK CONFIGURATION
# ============================================================================
NETWORK_NAME=mcp-memory-v4-test-network
VOLUME_SUFFIX=_test

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# PostgreSQL - Using safe test defaults
POSTGRES_DB=events_test
POSTGRES_USER=events
POSTGRES_PASSWORD=test_secret_changeme
EVENTS_DB_DSN=postgresql://events:test_secret_changeme@postgres:5432/events_test
POSTGRES_POOL_MIN=2
POSTGRES_POOL_MAX=5

# ChromaDB (internal Docker network)
CHROMA_HOST=chroma
CHROMA_PORT=8000
CHROMA_HTTP_HOST=chroma
CHROMA_HTTP_PORT=8000
CHROMA_HTTP_PROTOCOL=http
CHROMA_CLIENT_TYPE=http
CHROMA_COLLECTION_PREFIX=test_

# ============================================================================
# OPENAI CONFIGURATION
# ============================================================================
OPENAI_API_KEY=${OPENAI_API_KEY}
OPENAI_EMBED_MODEL=text-embedding-3-large
OPENAI_EVENT_MODEL=gpt-4o-mini

# ============================================================================
# V4 GRAPH CONFIGURATION
# ============================================================================
V4_GRAPH_ENABLED=true
V4_GRAPH_NAME=nur_test
V4_WORKER_GRAPH_UPSERT=true

# ============================================================================
# WORKER CONFIGURATION
# ============================================================================
WORKER_ID=worker-test-1
POLL_INTERVAL_MS=500
EVENT_MAX_ATTEMPTS=3

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
LOG_LEVEL=WARNING
LOG_FORMAT=text
LOG_OUTPUT=stdout

# ============================================================================
# MEMORY POLICY CONFIGURATION
# ============================================================================
MEMORY_CONFIDENCE_MIN=0.6
HISTORY_TAIL_N=16
MEMORY_TOP_K=8
MEMORY_MAX_PER_WINDOW=3

# ============================================================================
# PERFORMANCE CONFIGURATION
# ============================================================================
HTTP_TIMEOUT=30
MAX_CONCURRENT_REQUESTS=5
CONNECTION_POOL_SIZE=10
ENABLE_CACHING=false

# ============================================================================
# RATE LIMITING CONFIGURATION
# ============================================================================
RATE_LIMITING_ENABLED=false

# ============================================================================
# MONITORING CONFIGURATION
# ============================================================================
METRICS_ENABLED=false
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_PORT=8281

# ============================================================================
# FEATURE FLAGS
# ============================================================================
ENABLE_EXPERIMENTAL_FEATURES=true
DEBUG_MODE=false
ENABLE_PROFILING=false

# ============================================================================
# TEST-SPECIFIC CONFIGURATION
# ============================================================================
TEST_TIMEOUT_MS=30000
TEST_RETRY_COUNT=3
ALLOW_RESET=true

# ============================================================================
# MCP INSPECTOR CONFIGURATION
# ============================================================================
MCP_INSPECTOR_URL=http://localhost:6474
MCP_PROXY_AUTH_TOKEN=test-token

# ============================================================================
# NOTES
# ============================================================================
#
# Test Environment Purpose:
# - Automated testing with fast startup/teardown
# - Minimal logging (WARNING level) to reduce noise
# - Smaller connection pools for resource efficiency
# - ALLOW_RESET=true enables collection/database reset between tests
#
# Port Summary:
# - MCP Server: http://localhost:3201
# - ChromaDB: http://localhost:8201
# - PostgreSQL: localhost:5632
# - MCP Inspector: http://localhost:6474
#
# Volumes (isolated from production and staging):
# - mcp_memory_v4_chroma_data_test
# - mcp_memory_v4_postgres_data_test
#
# Running Tests:
# 1. Start environment: ./scripts/env-up.sh test
# 2. Run tests: pytest tests/playwright/ -v
# 3. Stop environment: ./scripts/env-down.sh test
# 4. Reset for clean state: ./scripts/env-reset.sh test
#
