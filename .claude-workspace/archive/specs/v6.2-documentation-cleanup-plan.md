# V6.2 Documentation & Reference Cleanup Plan

**Version:** 6.2.0
**Date:** 2026-01-01
**Status:** PENDING APPROVAL
**Prerequisite:** V6.1 code cleanup complete

---

## Executive Summary

After the V6.0 tool deletion (17 → 4 tools) and V6.1 code cleanup, there remain **~200+ files** across the codebase that reference the old tools or outdated versions. This plan identifies every file and categorizes the required action.

**Current V6 Tools (4 total):**
- `remember` - Store content
- `recall` - Search/retrieve
- `forget` - Delete with cascade
- `status` - Health check

**Infrastructure Environments (3 total):**

*Source of truth: `.claude-workspace/deployment/` compose files and `.env.example`*

| Environment | Compose File | MCP Port | ChromaDB Port | Config Reference |
|-------------|--------------|----------|---------------|------------------|
| Default/Prod | `docker-compose.yml` | 3000 | 8001 | `${MCP_PORT:-3000}` |
| Local Dev | `docker-compose.local.yml` | 3001 | 8001 | `${MCP_EXTERNAL_PORT:-3001}` |
| Test | `docker-compose.test.yml` | 3201 | 8201 | `${MCP_PORT:-3201}` |

> **⚠️ Port 3100 is INVALID.** It appears in some docs/code but doesn't match any environment config. All port references in docs MUST use the compose file defaults above or reference the env var pattern.

---

## File Inventory

**Total files with old tool references: 91** ✅ All categorized

### MISSED IN INITIAL AUDIT (now included):

| File/Directory | Issue | Action |
|----------------|-------|--------|
| `/temp/` | Benchmark outputs, AGE artifacts | **DELETE outputs only** (see Phase 1 safe list) |
| `mcp-server/TEST_COVERAGE.md` | Says "v2.0" | **ARCHIVE** |
| `mcp-server/V3_IMPLEMENTATION_SUMMARY.md` | Says "17 MCP tools" | **ARCHIVE** |
| `mcp-server/docs/BUG-GRAPH-UPSERT-NOT-PROCESSING.md` | V4 graph bug | **DELETE** (AGE removed) |
| `.claude-workspace/tests/COVERAGE-REPORT.md` | V4 coverage template | **ARCHIVE** |
| `.claude-workspace/implementation/IMPLEMENTATION-NOTES.md` | V4 implementation notes | **ARCHIVE** |

---

### Category 1: MUST UPDATE (Active user-facing docs)

| File | Issue | Action |
|------|-------|--------|
| **`/README.md`** | Claims V4, 17 tools, references AGE | **REWRITE** for V6 |
| ↳ *Location: repo root, user-facing project README* | | |
| **`.claude-workspace/implementation/mcp-server/README.md`** | Uses port 3100 (should match infra config) | **UPDATE** port refs |
| ↳ *Location: implementation dir, developer setup docs* | | |
| `.claude/docs/testing-requirements.md` | References `memory_store` | **UPDATE** tool names |
| `.claude/docs/quality-gates.md` | References old tools, "12 tools" | **UPDATE** tool names |
| `.claude-workspace/deployment/ROLLBACK.md` | V5→V4 rollback | **UPDATE** for V6 or DELETE |
| `.claude-workspace/deployment/ENVIRONMENTS.md` | References old tools | **UPDATE** |
| `.claude-workspace/current-task.json` | Says "V5" | **UPDATE** to V6 |
| `.claude-workspace/implementation/mcp-server/tests/README.md` | Claims "v2.0" | **UPDATE** to V6 |
| `.claude-workspace/implementation/mcp-server/test_mcp_flow.py` | Uses port 3100, valid V6 test script | **UPDATE** port ref, **KEEP** |
| ↳ *Active V6 reference: uses remember/recall/forget/status* | | |

**Count: 9 files**

---

### Category 2: DELETE (Legacy test suites - obsolete)

These test suites test deleted tools/code and cannot run against V6:

| Directory | Files | Reason |
|-----------|-------|--------|
| `.claude-workspace/tests/e2e-playwright/` | ~54 | Tests `artifact_ingest`, `hybrid_search`, etc. |
| `.claude-workspace/tests/e2e/` | 9 | Tests old tools + sample docs |
| `.claude-workspace/tests/ui/` | ~15 | Tests old MCP inspector flows |
| `.claude-workspace/tests/mcp-server/` | 11 | V3 event tool tests |
| `.claude-workspace/tests/v4/` | ~38 | V4-specific tests |
| `.claude-workspace/tests/integration/` | ~3 | Old integration tests |
| `.claude-workspace/implementation/test-memory.py` | 1 | V1 ChromaDB test script |
| `/temp/` (outputs only) | ~8 | Benchmark outputs, AGE artifacts (see safe list below) |
| `mcp-server/docs/BUG-GRAPH-UPSERT-NOT-PROCESSING.md` | 1 | V4 AGE bug (AGE removed) |

**Total: ~148 files to DELETE**

---

### Category 3: ARCHIVE (Historical docs - move to archive/)

Move to `.claude-workspace/archive/` to preserve history:

#### Specifications
| File | Version |
|------|---------|
| `specs/v1-specification.md` | V1 |
| `specs/v2-technical-spec.md` | V2 |
| `specs/v3-specification.md` | V3 |
| `specs/v4-specification.md` | V4 |
| `specs/v5-specification.md` | V5 |
| `specs/v5-phases/*` | V5 phases (~12 files) |
| `specs/tool-consolidation-proposal.md` | V5/V6 |
| `specs/v5-validation.md` | V5 |
| `specs/v6-cleanup-plan.md` | V6.0 |
| `specs/v6.1-cleanup-plan.md` | V6.1 |

#### Architecture
| File | Version |
|------|---------|
| `architecture/v3-architecture.md` | V3 |
| `architecture/v4/*` | V4 (~12 files) |
| `architecture/v5/*` | V5 (~3 files) |
| `architecture/ADR-001-embedding-strategy.md` | V2 |
| `architecture/ADR-002-chunking-architecture.md` | V2 |
| `architecture/ADR-003-hybrid-retrieval.md` | V2 |
| `architecture/ADR-004-module-structure.md` | V2 |
| `architecture/v2-ADR-INDEX.md` | V2 |
| `architecture/api-design.md` | V3 |
| `architecture/adr-001-postgres-over-kafka.md` | V3 |
| `architecture/adr-002-event-extraction-model.md` | V3 |
| `architecture/database-design.md` | V3 |

#### Docs
| File | Version |
|------|---------|
| `docs/ARCHITECTURE.md` | V2 |
| `docs/V2_CHANGES.md` | V2 |

#### Security
| File | Version |
|------|---------|
| `security/security-audit-report.md` | V2 |
| `security/v3-security-audit.md` | V3 |
| `security/v3-security-recommendations.md` | V3 |
| `security/v4-security-audit.md` | V4 |
| `security/remediation-plan.md` | V4 |
| `security/V3-AUDIT-SUMMARY.md` | V3 |

#### Deployment
| File | Version |
|------|---------|
| `deployment/v4/*` | V4 (~8 files) |
| `deployment/V3-*.md` | V3 (3 files) |
| `deployment/README-V3.md` | V3 |
| `deployment/docker-compose.v3*.yml` | V3 (2 files) |
| `deployment/docker-compose.test.yml` | V3/V4 |

#### Deliverables
| File | Version |
|------|---------|
| `deliverables/quality-review.md` | V1 |
| `deliverables/v2-quality-review.md` | V2 |
| `deliverables/v4-quality-review.md` | V4 |

#### Implementation Files
| File | Version |
|------|---------|
| `mcp-server/TEST_COVERAGE.md` | V2 |
| `mcp-server/V3_IMPLEMENTATION_SUMMARY.md` | V3 |
| `tests/COVERAGE-REPORT.md` | V4 |
| `implementation/IMPLEMENTATION-NOTES.md` | V4 |

#### Root Files
| File | Version |
|------|---------|
| `/v3.md` | V3 |
| `/v4.md` | V4 |
| `/requirments.md` | V2 |
| `/chroma_mcp_memory_v1.md` | V1 |

**Total: ~60+ files to ARCHIVE**

---

### Category 4: REVIEW (May keep, may delete)

| Directory/File | Notes | Decision |
|----------------|-------|----------|
| `.claude-workspace/implementation/mcp-server/docs/` | ✅ Only contains BUG-GRAPH-UPSERT (in DELETE) | Remove empty dir |

### Category 4b: DELETE (User confirmed)

| Directory/File | Notes |
|----------------|-------|
| `.claude-workspace/tests/agent-app/` | V1 agent tests, obsolete |
| `.claude-workspace/implementation/agent-app/` | V1 LLM agent app (uses old chroma-mcp, not V6 tools) |

---

### Category 5: KEEP AS-IS (Already V6 compatible)

| Location | Status |
|----------|--------|
| `mcp-server/tests/unit/services/test_retrieval_service.py` | ✅ Contains comment documenting V6.1 deletions (intentional) |
| `.claude-workspace/implementation/mcp-server/src/*` | ✅ V6.1 |
| `.claude-workspace/implementation/mcp-server/tests/*` | ✅ Current unit tests |
| `.claude-workspace/tests/v5/*` | ✅ Uses V6 tools (renamed to v6/ in Phase 4) |
| `.claude-workspace/security/v5-security-audit.md` | ✅ Current |
| `.claude-workspace/deployment/docker-compose.yml` | ✅ Current |
| `.claude-workspace/deployment/docker-compose.prod.yml` | ✅ Current |
| `.claude-workspace/deployment/scripts/*.sh` | ✅ Generic scripts |
| `CLAUDE.md` | ✅ Generic project instructions |

---

### Category 6: RENAME (Optional polish)

| Current | Proposed | Reason |
|---------|----------|--------|
| `.claude-workspace/tests/v5/` | `.claude-workspace/tests/v6/` | Consistency |
| `hybrid_search_v5()` function | `hybrid_search_v6()` | Internal only |
| `get_v5_chunks_by_content()` | `get_chunks_by_content()` | Internal only |

---

## Execution Plan

### Phase 1: Delete Legacy Tests (~131 files)

```bash
# Remove legacy test directories
rm -rf .claude-workspace/tests/e2e-playwright/
rm -rf .claude-workspace/tests/e2e/
rm -rf .claude-workspace/tests/ui/
rm -rf .claude-workspace/tests/mcp-server/
rm -rf .claude-workspace/tests/v4/
rm -rf .claude-workspace/tests/integration/
rm .claude-workspace/implementation/test-memory.py

# Remove temp OUTPUTS only (keep planning docs and scripts)
rm -f temp/bench50.out temp/bench50.pid
rm -f temp/benchmark_results_latest.json temp/benchmark_manifest.json
rm -f temp/v4.compose.env
rm -rf temp/neo4j_import/  # AGE-related
rm -f temp/artifact_processing_and_hybrid_search_diagram.md  # references old hybrid_search
rm -f temp/artifact_processing_and_hybrid_search_diagram.mmd
rm -f temp/hybrid_search_benchmark.md  # references old hybrid_search
rm -f temp/hybrid_search_benchmark_corpus_50.md

# KEEP these temp files (planning/progress docs):
# - temp/progress_plan.md
# - temp/debugging_progress.md
# - temp/quality_measurement_plan.md
# - temp/run_hybrid_search_benchmark.py (script, may need update)

# Remove obsolete bug report (AGE removed) and empty parent dir
rm .claude-workspace/implementation/mcp-server/docs/BUG-GRAPH-UPSERT-NOT-PROCESSING.md
rmdir .claude-workspace/implementation/mcp-server/docs/

# Remove obsolete V1 agent-app (uses old chroma-mcp, not V6 tools)
rm -rf .claude-workspace/tests/agent-app/
rm -rf .claude-workspace/implementation/agent-app/
```

**Risk:** Low - these tests cannot run against V6
**Reversibility:** Git history

---

### Phase 2: Archive Historical Docs (~60 files)

```bash
# Create archive structure
mkdir -p .claude-workspace/archive/{specs,architecture,docs,security,deployment,deliverables}

# Move specs
mv .claude-workspace/specs/v{1,2,3,4,5}-*.md .claude-workspace/archive/specs/
mv .claude-workspace/specs/v5-phases/ .claude-workspace/archive/specs/
mv .claude-workspace/specs/tool-consolidation-proposal.md .claude-workspace/archive/specs/

# Move architecture
mv .claude-workspace/architecture/v{3,4,5}-*.md .claude-workspace/archive/architecture/
mv .claude-workspace/architecture/v4/ .claude-workspace/archive/architecture/
mv .claude-workspace/architecture/v5/ .claude-workspace/archive/architecture/
mv .claude-workspace/architecture/ADR-00*.md .claude-workspace/archive/architecture/
mv .claude-workspace/architecture/v2-ADR-INDEX.md .claude-workspace/archive/architecture/
mv .claude-workspace/architecture/api-design.md .claude-workspace/archive/architecture/
mv .claude-workspace/architecture/adr-*.md .claude-workspace/archive/architecture/
mv .claude-workspace/architecture/database-design.md .claude-workspace/archive/architecture/

# Move docs
mv .claude-workspace/docs/*.md .claude-workspace/archive/docs/

# Move security
mv .claude-workspace/security/v{3,4}-*.md .claude-workspace/archive/security/
mv .claude-workspace/security/V3-*.md .claude-workspace/archive/security/
mv .claude-workspace/security/security-audit-report.md .claude-workspace/archive/security/
mv .claude-workspace/security/remediation-plan.md .claude-workspace/archive/security/

# Move deployment
mv .claude-workspace/deployment/v4/ .claude-workspace/archive/deployment/
mv .claude-workspace/deployment/V3-*.md .claude-workspace/archive/deployment/
mv .claude-workspace/deployment/README-V3.md .claude-workspace/archive/deployment/
mv .claude-workspace/deployment/docker-compose.v3*.yml .claude-workspace/archive/deployment/
mv .claude-workspace/deployment/docker-compose.test.yml .claude-workspace/archive/deployment/

# Move deliverables
mv .claude-workspace/deliverables/*.md .claude-workspace/archive/deliverables/

# Move root legacy docs
mv v3.md v4.md requirments.md chroma_mcp_memory_v1.md .claude-workspace/archive/

# Move implementation-level docs
mv .claude-workspace/implementation/mcp-server/TEST_COVERAGE.md .claude-workspace/archive/
mv .claude-workspace/implementation/mcp-server/V3_IMPLEMENTATION_SUMMARY.md .claude-workspace/archive/
mv .claude-workspace/tests/COVERAGE-REPORT.md .claude-workspace/archive/
mv .claude-workspace/implementation/IMPLEMENTATION-NOTES.md .claude-workspace/archive/
```

**Risk:** Low - preserves history, just moves files
**Reversibility:** Git history + files still in archive

---

### Phase 3: Update Active Docs (8 files + 1 delete)

#### 3.1 Root README.md (`/README.md`)
Complete rewrite for V6:
- 4 tools: remember, recall, forget, status
- Use correct environment ports (NOT 3100 which doesn't exist):
  - Default/Production: `MCP_PORT=3000`
  - Local development: `MCP_EXTERNAL_PORT=3001`
  - Test: `MCP_PORT=3201`
- Remove Apache AGE references
- Update quick start instructions

#### 3.2 Implementation README (`.claude-workspace/implementation/mcp-server/README.md`)
Update port references from 3100 to match infra config:
- Reference env var pattern: `${MCP_PORT:-3000}` or `${MCP_EXTERNAL_PORT:-3001}`
- For quick-start examples, use local dev default: `http://localhost:3001/mcp/`
- **Source of truth:** `docker-compose.local.yml` line 13

#### 3.3 test_mcp_flow.py (`.claude-workspace/implementation/mcp-server/test_mcp_flow.py`)
Update hardcoded port from 3100 to use environment variable:
```python
import os
MCP_URL = os.getenv("MCP_URL", "http://localhost:3001/mcp/")
```
- Default matches local dev environment (docker-compose.local.yml)
- Overridable via MCP_URL env var for test environment (3201)

#### 3.4 .claude/docs/testing-requirements.md
- Replace `memory_store` with `remember`
- Update tool count references
- Update test script references

#### 3.5 .claude/docs/quality-gates.md
- Replace tool names
- Update from "12 tools" to "4 tools"

#### 3.6 current-task.json
- Update status to V6
- Update deliverables references

#### 3.7 ROLLBACK.md
- **DELETE** (no V5 to rollback to, user confirmed)

#### 3.8 ENVIRONMENTS.md
- Update tool references

#### 3.9 mcp-server/tests/README.md
- Update from v2.0 to V6

---

### Phase 4: Renames (user confirmed)

```bash
# Rename test directory
mv .claude-workspace/tests/v5/ .claude-workspace/tests/v6/

# Update any imports/references to tests/v5 in pytest commands
# (check conftest.py, CI scripts, README files)
```

- ✅ Rename `tests/v5/` to `tests/v6/` (confirmed)
- Rename internal function names (optional, low priority)

---

## Verification Checklist

After cleanup, verify:

### Notes on “legacy strings” that may remain (acceptable)

Some strings overlap between old tool names and V6 data fields or historical commentary. These are acceptable if they are **not tool exposures**:

- **`job_status`**: V6 `status()` may return a `job_status` **field** when `artifact_id` is provided. This is not the legacy `job_status` tool.
- **`hybrid_search`**: A unit test may mention "`hybrid_search` deleted" in a comment documenting the V6.1 cleanup. This is fine.

```bash
# 1. No old tool references in active code (check all 17 deleted tools)
grep -rn "memory_store\|memory_search\|memory_list\|memory_delete" \
  --include="*.py" --include="*.md" \
  . | grep -v archive/ | grep -v ".venv/"

grep -rn "artifact_ingest\|artifact_search\|artifact_get\|artifact_delete" \
  --include="*.py" --include="*.md" \
  . | grep -v archive/ | grep -v ".venv/"

grep -rn "hybrid_search\|event_search_tool\|event_get_tool\|event_list_for_artifact\|event_reextract" \
  --include="*.py" --include="*.md" \
  . | grep -v archive/ | grep -v ".venv/" | grep -v "tests/unit/services/test_retrieval_service.py"

grep -rn "embedding_health\|history_append\|history_get" \
  --include="*.py" --include="*.md" \
  . | grep -v archive/ | grep -v ".venv/"

# 2. Tests still pass (note: tests/v5 renamed to tests/v6 in Phase 4)
cd .claude-workspace/implementation/mcp-server
PYTHONPATH=src pytest tests/ ../../tests/v6/ -v

# 3. Only V6 tools exposed (use port for your environment: 3000/3001/3201)
curl -X POST http://localhost:3001/mcp/ \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","method":"tools/list","id":1}'
# Should return: remember, recall, forget, status

# 4. Archive exists
ls .claude-workspace/archive/
```

---

## Summary

| Action | File Count | Effort |
|--------|------------|--------|
| DELETE | ~150 | Low (rm -rf) |
| ARCHIVE | ~64 | Low (mv) |
| UPDATE | 8 | Medium (manual edits) |
| RENAME | 1 dir + 2 funcs | Low |
| **TOTAL** | ~224 | 2-3 hours |

---

## Decision Points

1. **Delete vs Archive specs?** Recommend ARCHIVE to preserve decision history
2. ~~**Keep agent-app?**~~ ✅ Confirmed: DELETE (V1 app, obsolete)
3. ~~**Rename tests/v5 to tests/v6?**~~ ✅ Confirmed: DO IT
4. ~~**Keep ROLLBACK.md?**~~ ✅ Confirmed: DELETE

---

## Approval

- [ ] User approves DELETE of legacy tests
- [ ] User approves ARCHIVE strategy (vs full delete)
- [x] User confirms agent-app disposition → DELETE
- [ ] User approves README rewrite scope

---

## Post-Execution

After V6.2 cleanup is complete:
1. Archive this plan: `mv specs/v6.2-documentation-cleanup-plan.md archive/specs/`
2. Update `current-task.json` status to "V6.2 complete"
3. Commit with message: `docs: V6.2 documentation cleanup complete`
